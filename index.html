<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no" />

  <title>å¯äº‘</title>

  <!-- umi.jsï¼šä¿æŒä¸å˜ -->
  <script type="module" crossorigin src="/assets/umi.js"></script>

  <!-- ç™»å½•èƒŒæ™¯è‡ªå®šä¹‰å˜é‡ï¼ˆå¯ä¸æ”¹ï¼‰ -->
  <style>
    :root {
      --login-bg: url('/assets/login-bg.jpg');
    }

    /* æ–°äººå…¬å‘Šå¼¹çª—æ ·å¼ */
    .notice-mask {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(4px);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999999;
    }

    .notice-box {
      width: 82%;
      max-width: 380px;
      background: #fff;
      padding: 20px;
      border-radius: 18px;
      text-align: center;
      animation: ky-popup .3s ease;
      box-shadow: 0 12px 35px rgba(0,0,0,0.16);
    }

    .notice-close {
      font-size: 22px;
      cursor: pointer;
      text-align: right;
      margin-bottom: 8px;
    }

    @keyframes ky-popup {
      from { transform: scale(.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
  </style>
</head>

<body>

  <!-- åŠ è½½ç¯å¢ƒé…ç½®ï¼ˆæ³¨æ„ï¼šæŒ‰ä½ é¡¹ç›®æ¥é€‰æ‹© env.js æˆ– env.example.jsï¼‰-->
  <script src="./env.example.js"></script>

  <div id="app"></div>

  <!-- ======================== ç™»å½•æˆåŠŸåŒå¼¹çª—é€»è¾‘ ======================== -->
  <script>
  (function () {
    const DASHBOARD_PATH = "/dashboard"; // ç™»å½•åè¿›å…¥ dashboard æ‰å¼€å§‹å¼¹çª—

    let popupInitialized = false;
    let firstClosed = false;
    let secondShown = false;

    // ----------------- åˆ›å»ºå¼¹çª— DOM -----------------
    function createNoticePopup(onClose) {
      const mask = document.createElement("div");
      mask.className = "notice-mask";

      mask.innerHTML = `
        <div class="notice-box">
          <div class="notice-close" id="noticeClose">Ã—</div>

          <h2>ğŸ“¢ æ–°äººå¿…çœ‹å…¬å‘Š</h2>

          <p style="line-height:1.6;">æ¬¢è¿æ¥åˆ°å¯äº‘ï¼Œè¯·åŠ¡å¿…é˜…è¯»é¡¶éƒ¨å…¬å‘Šæ ä¿¡æ¯ã€‚</p>
          <p style="line-height:1.6;">è¯·æ”¶è—æœ€æ–°åœ°å€ï¼š<b>shy521.com</b></p>
          <p style="line-height:1.6;margin-bottom:18px;">
            åŠ å…¥ TG ç¾¤ç»„ï¼š<a href="https://t.me/ss_keyun" target="_blank">t.me/ss_keyun</a>
          </p>
        </div>
      `;

      document.body.appendChild(mask);

      mask.querySelector("#noticeClose").onclick = () => {
        mask.remove();
        if (typeof onClose === "function") onClose();
      };
    }

    // ----------------- ç›‘å¬è·¯ç”±è¿›å…¥ dashboard -----------------
    function watchDashboardRoute() {
      setInterval(() => {
        const hashPath = location.hash.replace("#", "");
        if (!popupInitialized && hashPath.startsWith(DASHBOARD_PATH)) {
          popupInitialized = true;
          startTwoPopups();
        }
      }, 300);
    }

    // ----------------- å¼€å§‹ç¬¬ä¸€æ¬¡ + ç¬¬äºŒæ¬¡å¼¹çª— -----------------
    function startTwoPopups() {
      // ç¬¬ä¸€æ¬¡ï¼šç™»å½•æˆåŠŸ 1.5 ç§’åè‡ªåŠ¨å¼¹å‡º
      setTimeout(() => {
        createNoticePopup(() => {
          firstClosed = true;
          startSecondPopupMonitor();
        });
      }, 1500);
    }

    // ----------------- ç¬¬äºŒæ¬¡å¼¹çª—ç‚¹å‡»ç›‘å¬ -----------------
    function startSecondPopupMonitor() {
      let monitorActive = true;

      function clickHandler() {
        if (!monitorActive || secondShown) return;

        monitorActive = false;
        document.removeEventListener("click", clickHandler, true);

        // éšæœºå»¶è¿Ÿ 3 ~ 10 ç§’
        const delay = 3000 + Math.floor(Math.random() * 7000);

        setTimeout(() => {
          if (!secondShown) {
            secondShown = true;
            createNoticePopup();
          }
        }, delay);
      }

      // ç›‘å¬ä»»æ„ç‚¹å‡»
      document.addEventListener("click", clickHandler, true);

      // ç›‘å¬æœ‰æ•ˆæœŸ 60 ç§’
      setTimeout(() => {
        monitorActive = false;
        document.removeEventListener("click", clickHandler, true);
      }, 60000);
    }

    // å¯åŠ¨ç›‘å¬
    watchDashboardRoute();
  })();
  </script>

</body>
</html>
